__NUXT_JSONP__("/articles/yubikey-login", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q){return {data:[{article:{slug:"yubikey-login",description:"Configure Pop!_OS to accept a Yubikey for login and unlock.\n",title:"Login with Yubikey",keywords:["Yubikey","Administration"],facebookImage:"\u002F_nuxt\u002Fimages\u002Fyubikey-login-facebookImage.jpg",twitterImage:"\u002F_nuxt\u002Fimages\u002Fyubikey-login-twitterImage.jpg",hidden:false,section:"community",tableOfContents:true,toc:[{id:B,depth:o,text:C},{id:D,depth:o,text:E},{id:F,depth:o,text:G},{id:H,depth:o,text:I},{id:J,depth:o,text:K}],body:{type:"root",children:[{type:b,tag:d,props:{},children:[{type:a,value:"If you have a Yubikey, you can use it to login or unlock your system."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"To do this you must install the yubikey packages, configure a challenge-response slot on the Yubikey, and then configure the necessary PAM modules."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:p,props:{},children:[{type:a,value:"NOTE:"}]},{type:a,value:" Open an additional root terminal: "},{type:b,tag:f,props:{},children:[{type:a,value:"sudo su"}]}]},{type:a,value:c},{type:b,tag:q,props:{id:B},children:[{type:b,tag:g,props:{href:"#install-packages",ariaHidden:r,tabIndex:s},children:[{type:b,tag:e,props:{className:[t,u]},children:[]}]},{type:a,value:C}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"To install the necessary packages, run:"}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k],style:l},children:[{type:b,tag:f,props:{},children:[{type:b,tag:e,props:{className:[m]},children:[{type:b,tag:e,props:{style:n},children:[{type:a,value:"sudo apt install -y libpam-yubico yubikey-personalization yubikey-manager\n"}]}]}]}]}]},{type:a,value:c},{type:b,tag:q,props:{id:D},children:[{type:b,tag:g,props:{href:"#configure-challenge-response-for-your-yubikey",ariaHidden:r,tabIndex:s},children:[{type:b,tag:e,props:{className:[t,u]},children:[]}]},{type:a,value:E}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"To enable challenge-response on your Yubikey in slot 2, type the following command:"}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k],style:l},children:[{type:b,tag:f,props:{},children:[{type:b,tag:e,props:{className:[m]},children:[{type:b,tag:e,props:{style:n},children:[{type:a,value:"ykman otp chalresp -g 2\n"}]}]}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"This configures slot 2 for challenge-response, and leaves slot 1 alone."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Next we need to create a place to store your challenge response files, secure those files, and finally create the stored challenge files:"}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k],style:l},children:[{type:b,tag:f,props:{},children:[{type:b,tag:e,props:{className:[m]},children:[{type:b,tag:e,props:{style:n},children:[{type:a,value:"sudo mkdir \u002Fvar\u002Fyubico\nsudo chown root \u002Fvar\u002Fyubico\nsudo chmod 700 \u002Fvar\u002Fyubico\nykpamcfg -2 -v\n"}]}]}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"You should receive a message similar to:"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:f,props:{},children:[{type:a,value:"Stored initial challenge and expected response in '$HOME\u002F.yubico\u002Fchallenge-123456'."}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"You should receive a unique "},{type:b,tag:v,props:{},children:[{type:a,value:"challenge-serial"}]},{type:a,value:" in your output."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Now, to finish up:"}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k],style:l},children:[{type:b,tag:f,props:{},children:[{type:b,tag:e,props:{className:[m]},children:[{type:b,tag:e,props:{style:n},children:[{type:a,value:"sudo mv ~\u002F.yubico\u002Fchallenge-123456 \u002Fvar\u002Fyubico\u002Faaronh-serial\nsudo chown root.root \u002Fvar\u002Fyubico\u002Faaronh-serial\nsudo chmod 600 \u002Fvar\u002Fyubico\u002Faaronh-serial\n"}]}]}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Pay close attention when copying\u002Fpasting the commands above.  The "},{type:b,tag:v,props:{},children:[{type:a,value:"challenge-123456"}]},{type:a,value:" and "},{type:b,tag:v,props:{},children:[{type:a,value:"aaronh-serial"}]},{type:a,value:" needs to match the both the output from the "},{type:b,tag:f,props:{},children:[{type:a,value:"ykpamcfg"}]},{type:a,value:" command and the final file needs to match the name of your user name and serial.**"}]},{type:a,value:c},{type:b,tag:q,props:{id:F},children:[{type:b,tag:g,props:{href:"#configure-plugable-authentication-modules",ariaHidden:r,tabIndex:s},children:[{type:b,tag:e,props:{className:[t,u]},children:[]}]},{type:a,value:G}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:p,props:{},children:[{type:a,value:"Before making any changes to the files listed below, I highly recommend backing up each file, and having a sudo\u002Froot session open in case you need to roll-back."}]}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k],style:l},children:[{type:b,tag:f,props:{},children:[{type:b,tag:e,props:{className:[m]},children:[{type:b,tag:e,props:{style:n},children:[{type:a,value:"sudo dpkg-reconfigure libpam-yubico\n"}]}]}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"You will want to change the \"Parameters for Yubico PAM:\" to be:"}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k],style:l},children:[{type:b,tag:f,props:{},children:[{type:b,tag:e,props:{className:[m]},children:[{type:b,tag:e,props:{style:n},children:[{type:a,value:"mode=challenge-response debug chalresp_path=\u002Fvar\u002Fyubico\n"}]}]}]}]}]},{type:a,value:c},{type:b,tag:"blockquote",props:{},children:[{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:p,props:{},children:[{type:a,value:"Note:"}]},{type:a,value:" The debug option is used for testing the change, review the Debugging and Testing section of this article for more information."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:L,props:{alt:"dpkg-reconfigure-pg1",src:"\u002Fimages\u002Fyubikey-login\u002Fdpkg-reconfigure-pg1.png"},children:[]},{type:a,value:c},{type:b,tag:L,props:{alt:"dpkg-reconfigure-pg2",src:"\u002Fimages\u002Fyubikey-login\u002Fdpkg-reconfigure-pg2.png"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Setting this to sufficient is the recommended method as the login manager will take your password "},{type:b,tag:p,props:{},children:[{type:a,value:"or"}]},{type:a,value:" the Yubikey to login. To do this you will need to change the second setting in the following line in "},{type:b,tag:f,props:{},children:[{type:a,value:M}]},{type:a,value:":"}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k],style:l},children:[{type:b,tag:f,props:{},children:[{type:b,tag:e,props:{className:[m]},children:[{type:b,tag:e,props:{style:n},children:[{type:a,value:"auth sufficient pam_yubico.so mode=challenge-response chalresp_path=\u002Fvar\u002Fyubico\n"}]}]}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"This configures your system to accept your Yubikey as an acceptable login alternative."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"If you want your Yubiky to be "},{type:b,tag:p,props:{},children:[{type:a,value:"required to login"}]},{type:a,value:", then you need to change "},{type:b,tag:v,props:{},children:[{type:a,value:"sufficient"}]},{type:a,value:" to "},{type:b,tag:v,props:{},children:[{type:a,value:"required"}]},{type:a,value:" (which is the default).  For example:"}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k],style:l},children:[{type:b,tag:f,props:{},children:[{type:b,tag:e,props:{className:[m]},children:[{type:b,tag:e,props:{style:n},children:[{type:a,value:N}]}]}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"There a a number of other options for PAM and ways to configure that to your liking.  Check the "},{type:b,tag:g,props:{href:"https:\u002F\u002Fmanpages.ubuntu.com\u002Fmanpages\u002Fjammy\u002Fen\u002Fman5\u002Fpam.d.5.html",rel:[w,x,y],target:z},children:[{type:a,value:"man pages for more information"}]},{type:a,value:".  Also, the "},{type:b,tag:g,props:{href:O,rel:[w,x,y],target:z},children:[{type:a,value:"Yubico PAM module"}]},{type:a,value:" page has a pretty good breakdown."}]},{type:a,value:c},{type:b,tag:P,props:{},children:[{type:a,value:c},{type:b,tag:A,props:{},children:[{type:a,value:M}]},{type:a,value:c},{type:b,tag:A,props:{},children:[{type:a,value:"\u002Fetc\u002Fpam.d\u002Flogin"}]},{type:a,value:c},{type:b,tag:A,props:{},children:[{type:a,value:"\u002Fetc\u002Fpam.d\u002Fgdm-password"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:q,props:{id:H},children:[{type:b,tag:g,props:{href:"#debugging-and-testing-your-pam-configuration",ariaHidden:r,tabIndex:s},children:[{type:b,tag:e,props:{className:[t,u]},children:[]}]},{type:a,value:I}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"You will want to keep a root terminal logged in while setting this up to make sure you can reverse any changes that do not allow you to login.  In the initial setup, the parameters to setup libpam-yubico included debug message. \"Sudo\" on the command line will now show debug output when run."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"With the Yubikey plugged into the system simulate a login with the following commands:"}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k],style:l},children:[{type:b,tag:f,props:{},children:[{type:b,tag:e,props:{className:[m]},children:[{type:b,tag:e,props:{style:n},children:[{type:a,value:"support@pop-os:~$ sudo -s\n[snip lots of logging]\n[sudo] password for support:\nroot@pop-os:\u002Fhome\u002Fsupport#\n"}]}]}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Test you setup if you are changing the \"sufficient\" setting to \"required\" before removing the \"debug\" setting. Use new terminal windows to simulate a login both with your Yubikey attached and out of the system. In \"required\" mode, you should not be able to finish a login with the Yubikey not plugged into your system."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Once you are sure that this works with your testing, remove the debug option:"}]},{type:a,value:c},{type:b,tag:h,props:{className:[i]},children:[{type:b,tag:j,props:{className:[k],style:l},children:[{type:b,tag:f,props:{},children:[{type:b,tag:e,props:{className:[m]},children:[{type:b,tag:e,props:{style:n},children:[{type:a,value:N}]}]}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"from \"\u002Fetc\u002Fpam.d\u002Fcommon-auth\"."}]},{type:a,value:c},{type:b,tag:q,props:{id:J},children:[{type:b,tag:g,props:{href:"#references",ariaHidden:r,tabIndex:s},children:[{type:b,tag:e,props:{className:[t,u]},children:[]}]},{type:a,value:K}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"The following sites were used to build this guide:"}]},{type:a,value:c},{type:b,tag:P,props:{},children:[{type:a,value:c},{type:b,tag:A,props:{},children:[{type:b,tag:g,props:{href:"https:\u002F\u002Fdevelopers.yubico.com\u002Fyubico-pam\u002FAuthentication_Using_Challenge-Response.html",rel:[w,x,y],target:z},children:[{type:a,value:"Authentication Using Challenge Response"}]},{type:a,value:Q}]},{type:a,value:c},{type:b,tag:A,props:{},children:[{type:b,tag:g,props:{href:O,rel:[w,x,y],target:z},children:[{type:a,value:"Yubico PAM Module"}]},{type:a,value:Q}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:"hr",props:{},children:[]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"This article was contributed by "},{type:b,tag:g,props:{href:"https:\u002F\u002Fgithub.com\u002F71nuxadd1ct",rel:[w,x,y],target:z},children:[{type:a,value:"71nuxadd1ct"}]},{type:a,value:"."}]}]},dir:"\u002F",path:"\u002Fyubikey-login",extension:".md",createdAt:"2019-07-31T23:05:25.000Z",updatedAt:"2023-07-28T17:16:48.000Z",authors:[{username:"thomas-zimmerman",commitUrl:"https:\u002F\u002Fgithub.com\u002Fsystem76\u002Fdocs\u002Fcommit\u002Fecfaa9cc6f00fad276a9c72454894643e2ab344a",avatarUrl:"https:\u002F\u002Favatars.githubusercontent.com\u002Fu\u002F41023059?v=4",profileUrl:"https:\u002F\u002Fgithub.com\u002Fthomas-zimmerman"},{username:"storyaddict",commitUrl:"https:\u002F\u002Fgithub.com\u002Fsystem76\u002Fdocs\u002Fcommit\u002Fc9848a422ea3c18962f9e13ead04a335c884b43e",avatarUrl:"https:\u002F\u002Favatars.githubusercontent.com\u002Fu\u002F55410594?v=4",profileUrl:"https:\u002F\u002Fgithub.com\u002Fstoryaddict"},{username:"btkostner",commitUrl:"https:\u002F\u002Fgithub.com\u002Fsystem76\u002Fdocs\u002Fcommit\u002Fe54bdadaf285cdda4147b9f7bfc8a53111584b5a",avatarUrl:"https:\u002F\u002Favatars.githubusercontent.com\u002Fu\u002F3385679?v=4",profileUrl:"https:\u002F\u002Fgithub.com\u002Fbtkostner"}]},_img:{"/_ipx/w_320,f_png/images/yubikey-login/dpkg-reconfigure-pg1.png":"\u002F_nuxt\u002Fimage\u002Fe4796f.png","/_ipx/w_640,f_png/images/yubikey-login/dpkg-reconfigure-pg1.png":"\u002F_nuxt\u002Fimage\u002F73cff5.png","/_ipx/w_768,f_png/images/yubikey-login/dpkg-reconfigure-pg1.png":"\u002F_nuxt\u002Fimage\u002F835351.png","/_ipx/w_1024,f_png/images/yubikey-login/dpkg-reconfigure-pg1.png":"\u002F_nuxt\u002Fimage\u002Fb5fb8f.png","/_ipx/w_1280,f_png/images/yubikey-login/dpkg-reconfigure-pg1.png":"\u002F_nuxt\u002Fimage\u002Fdb0704.png","/_ipx/w_1536,f_png/images/yubikey-login/dpkg-reconfigure-pg1.png":"\u002F_nuxt\u002Fimage\u002F5bdc13.png","/_ipx/w_320,f_webp/images/yubikey-login/dpkg-reconfigure-pg1.png":"\u002F_nuxt\u002Fimage\u002F4c0a1b.webp","/_ipx/w_640,f_webp/images/yubikey-login/dpkg-reconfigure-pg1.png":"\u002F_nuxt\u002Fimage\u002F80d041.webp","/_ipx/w_768,f_webp/images/yubikey-login/dpkg-reconfigure-pg1.png":"\u002F_nuxt\u002Fimage\u002F3b30ff.webp","/_ipx/w_1024,f_webp/images/yubikey-login/dpkg-reconfigure-pg1.png":"\u002F_nuxt\u002Fimage\u002F6682fe.webp","/_ipx/w_1280,f_webp/images/yubikey-login/dpkg-reconfigure-pg1.png":"\u002F_nuxt\u002Fimage\u002F1094d6.webp","/_ipx/w_1536,f_webp/images/yubikey-login/dpkg-reconfigure-pg1.png":"\u002F_nuxt\u002Fimage\u002Fddd9b1.webp","/_ipx/w_320,f_png/images/yubikey-login/dpkg-reconfigure-pg2.png":"\u002F_nuxt\u002Fimage\u002Ff22072.png","/_ipx/w_640,f_png/images/yubikey-login/dpkg-reconfigure-pg2.png":"\u002F_nuxt\u002Fimage\u002F163bb2.png","/_ipx/w_768,f_png/images/yubikey-login/dpkg-reconfigure-pg2.png":"\u002F_nuxt\u002Fimage\u002F8617b2.png","/_ipx/w_1024,f_png/images/yubikey-login/dpkg-reconfigure-pg2.png":"\u002F_nuxt\u002Fimage\u002F7a7176.png","/_ipx/w_1280,f_png/images/yubikey-login/dpkg-reconfigure-pg2.png":"\u002F_nuxt\u002Fimage\u002F50b38e.png","/_ipx/w_1536,f_png/images/yubikey-login/dpkg-reconfigure-pg2.png":"\u002F_nuxt\u002Fimage\u002F4d1484.png","/_ipx/w_320,f_webp/images/yubikey-login/dpkg-reconfigure-pg2.png":"\u002F_nuxt\u002Fimage\u002Febde84.webp","/_ipx/w_640,f_webp/images/yubikey-login/dpkg-reconfigure-pg2.png":"\u002F_nuxt\u002Fimage\u002F43cdee.webp","/_ipx/w_768,f_webp/images/yubikey-login/dpkg-reconfigure-pg2.png":"\u002F_nuxt\u002Fimage\u002F31ea49.webp","/_ipx/w_1024,f_webp/images/yubikey-login/dpkg-reconfigure-pg2.png":"\u002F_nuxt\u002Fimage\u002F4d7842.webp","/_ipx/w_1280,f_webp/images/yubikey-login/dpkg-reconfigure-pg2.png":"\u002F_nuxt\u002Fimage\u002Fd16b7d.webp","/_ipx/w_1536,f_webp/images/yubikey-login/dpkg-reconfigure-pg2.png":"\u002F_nuxt\u002Fimage\u002F8bf50a.webp"}}],fetch:{},mutations:void 0}}("text","element","\n","p","span","code","a","div","nuxt-content-highlight","pre","shiki","background-color: var(--code-00)","line","color: var(--code-0F)",2,"strong","h2","true",-1,"icon","icon-link","em","nofollow","noopener","noreferrer","_blank","li","install-packages","Install Packages","configure-challenge-response-for-your-yubikey","Configure Challenge-Response for your Yubikey","configure-plugable-authentication-modules","Configure Plugable Authentication Modules","debugging-and-testing-your-pam-configuration","Debugging and Testing your PAM configuration","references","References","nuxt-picture","\u002Fetc\u002Fpam.d\u002Fcommon-auth","auth required pam_yubico.so mode=challenge-response chalresp_path=\u002Fvar\u002Fyubico\n","https:\u002F\u002Fdevelopers.yubico.com\u002Fyubico-pam\u002F","ul"," (From Yubikey).")));